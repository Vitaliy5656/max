# –û—Ç—á–µ—Ç —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞—É–¥–∏—Ç–∞ (/logic)

**–î–∞—Ç–∞:** 2025-12-13
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è CRITICAL ISSUES FOUND
**–ê—É–¥–∏—Ç–æ—Ä:** Antigravity Agent

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ù–ê–•–û–î–ö–ò (Priority 0)

### [src/core/rag.py] RAG Engine

- ü§• **LOGIC LIE (Broken References)**:
  –í `api.py` (—Å—Ç—Ä–æ–∫–∞ 717) –∑–∞–≥—Ä—É–∂–∞–µ–º—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª (`tempfile`), –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç—Å—è –≤ `rag.py`, –∞ –∑–∞—Ç–µ–º **—É–¥–∞–ª—è–µ—Ç—Å—è** (—Å—Ç—Ä–æ–∫–∞ 730).
  –û–¥–Ω–∞–∫–æ `rag.py` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –∫ —ç—Ç–æ–º—É –≤—Ä–µ–º–µ–Ω–Ω–æ–º—É —Ñ–∞–π–ª—É –≤ –ë–î (`file_path`).
  **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°—Å—ã–ª–∫–∞ –≤ –ë–î –≤–µ–¥–µ—Ç –≤ –Ω–∏–∫—É–¥–∞. –ï—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª –∏–ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å –µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ‚Äî —Å–∏—Å—Ç–µ–º–∞ —É–ø–∞–¥–µ—Ç –∏–ª–∏ –≤–µ—Ä–Ω–µ—Ç –æ—à–∏–±–∫—É.

### [src/core/memory.py] Memory Manager

- üîç **DATA LOSS (Summary Overwrite)**:
  –í –º–µ—Ç–æ–¥–µ `compress_history` (—Å—Ç—Ä–æ–∫–∞ 451) –Ω–æ–≤—ã–π `summary` –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ –ë–î. –ú–µ—Ç–æ–¥ `get_smart_context` (—Å—Ç—Ä–æ–∫–∞ 314) –±–µ—Ä–µ—Ç —Ç–æ–ª—å–∫–æ **–ø–æ—Å–ª–µ–¥–Ω—é—é** –∑–∞–ø–∏—Å—å (`LIMIT 1`).
  –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏ (–∫–æ–≥–¥–∞ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è) —Å—Ç–∞—Ä–æ–µ "—Ä–µ–∑—é–º–µ" –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è –∏ –Ω–µ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç—Å—è —Å –Ω–æ–≤—ã–º.
  **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ê–º–Ω–µ–∑–∏—è. –°–∏—Å—Ç–µ–º–∞ –ø–æ–º–Ω–∏—Ç —Ç–æ–ª—å–∫–æ –∫—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ *–ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ* –∫—É—Å–∫–∞ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞, —Ç–µ—Ä—è—è –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–∞—á–∞–ª–∞ –±–µ—Å–µ–¥—ã.

---

## üõ† –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ (Priority 1)

### [src/api/api.py] API Layer

- ü§• **LOGIC LIE (Fake Guarantee)**:
  –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π `Guaranteed save even on disconnect` (—Å—Ç—Ä–æ–∫–∞ 610) –≤—Ä–µ—Ç. –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `full_response` –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏. –ï—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å —É–ø–∞–¥–µ—Ç (OOM, kill) –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏, –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–ø–∞–¥—É—Ç. –ù–∞—Å—Ç–æ—è—â–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è —Ç—Ä–µ–±—É–µ—Ç –∑–∞–ø–∏—Å–∏ —á–∞–Ω–∫–æ–≤ –≤ –ë–î –ø–æ –º–µ—Ä–µ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è.
- üìâ **LAZY IMPL (Pagination)**:
  –≠–Ω–¥–ø–æ–∏–Ω—Ç `list_conversations` (—Å—Ç—Ä–æ–∫–∞ 658) –∏–º–µ–µ—Ç `limit=50`, –Ω–æ **–Ω–µ –∏–º–µ–µ—Ç offset**.
  **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —É–≤–∏–¥–∏—Ç 51-–π —Ä–∞–∑–≥–æ–≤–æ—Ä. "–ú–µ—Ä—Ç–≤—ã–π" —Å–ø–∏—Å–æ–∫.
- üîÄ **RACE CONDITION**:
  –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö `_autogpt_agent` –∏ `_initialized`. –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –≤–æ—Ä–∫–µ—Ä–∞–º–∏ (Uvicorn workers > 1) –∫–∞–∂–¥—ã–π –ø—Ä–æ—Ü–µ—Å—Å –±—É–¥–µ—Ç –∏–º–µ—Ç—å —Å–≤–æ–µ–≥–æ –∞–≥–µ–Ω—Ç–∞, –∏ –æ–Ω–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –±—É–¥—É—Ç –∑–Ω–∞—Ç—å –¥—Ä—É–≥ –æ –¥—Ä—É–≥–µ.

### [src/core/autogpt.py] Autonomous Agent

- ü§• **LOGIC LIE (Blind Trust)**:
  –ú–µ—Ç–æ–¥ `_check_goal_completed` (—Å—Ç—Ä–æ–∫–∞ 467) —Å—á–∏—Ç–∞–µ—Ç –∑–∞–¥–∞—á—É –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–π, –µ—Å–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –≤—Å–µ —à–∞–≥–∏ –ø–ª–∞–Ω–∞ (`run.plan`). –ù–æ –ø–ª–∞–Ω –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è LLM.
  **–°—Ü–µ–Ω–∞—Ä–∏–π**: –ê–≥–µ–Ω—Ç —Å–æ–∑–¥–∞–µ—Ç –ø–ª–∞–Ω –∏–∑ 1 —à–∞–≥–∞ "–ü–æ–¥—É–º–∞—Ç—å". –í—ã–ø–æ–ª–Ω—è–µ—Ç –µ–≥–æ. –°–∏—Å—Ç–µ–º–∞ —Å—á–∏—Ç–∞–µ—Ç, —á—Ç–æ —Ü–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞, —Ö–æ—Ç—è —Ä–∞–±–æ—Ç–∞ –Ω–µ —Å–¥–µ–ª–∞–Ω–∞.
- üß© **STATE BUG (No Concurrency Control)**:
  –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ `_run_lock` (—Å—Ç—Ä–æ–∫–∞ 102) —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –æ–¥–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞. –ü—Ä–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏ –∞–≥–µ–Ω—Ç—ã –º–æ–≥—É—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å –∑–∞ –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ —Ä–µ—Å—É—Ä—Å—ã/—Ñ–∞–π–ª—ã.

### [src/core/tools.py] Tool System

- üìâ **LAZY IMPL (Directories)**:
  `list_directory` (—Å—Ç—Ä–æ–∫–∞ 352) –ø—Ä–æ—Å—Ç–æ –æ–±—Ä–µ–∑–∞–µ—Ç –≤—ã–≤–æ–¥ –ø–æ—Å–ª–µ 500 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏ –ø–∏—à–µ—Ç `[... truncated]`.
  **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ê–≥–µ–Ω—Ç –Ω–µ –º–æ–∂–µ—Ç –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±–æ–ª—å—à–æ–π –ø–∞–ø–∫–∏, —Ç–∞–∫ –∫–∞–∫ –Ω–µ—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞.
- üîç **DATA GAP (Search)**:
  `web_search` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Ä–µ–∑—é–º–µ. –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º, –ø–æ–ª–Ω—ã–º —Å–Ω–∏–ø–ø–µ—Ç–∞–º –∏–ª–∏ JSON-–æ—Ç–≤–µ—Ç—É –¥–ª—è –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.

### [src/core/lm/streaming.py] Streaming

- üîç **DATA GAP (UI)**:
  –ö–æ–Ω—Ç–µ–Ω—Ç "–º—ã—Å–ª–µ–π" (thinking content) –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è –¥–æ 2000 —Å–∏–º–≤–æ–ª–æ–≤ (—Å—Ç—Ä–æ–∫–∞ 193).
  **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –í —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö (DeepSeek R1) —Å–∞–º–æ–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–µ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–∫—Ä—ã—Ç–æ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

---

## üìã –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

1. **RAG**: –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∂–∞–µ–º—ã–µ —Ñ–∞–π–ª—ã –≤ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (`data/uploads/`) –ø–µ—Ä–µ–¥ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–µ–π.
2. **Memory**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—É—é —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—é (Merge: –°—Ç–∞—Ä–æ–µ —Å–∞–º–º–∞—Ä–∏ + –ù–æ–≤–æ–µ —Å–∞–º–º–∞—Ä–∏ -> –û–±—â–µ–µ —Å–∞–º–º–∞—Ä–∏).
3. **AutoGPT**: –î–æ–±–∞–≤–∏—Ç—å —ç—Ç–∞–ø "–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞" (Review) –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º, –≥–¥–µ –∞–≥–µ–Ω—Ç —Å–∞–º –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –¥–æ—Å—Ç–∏–≥ –ª–∏ —Ü–µ–ª–∏.
4. **API**: –î–æ–±–∞–≤–∏—Ç—å `offset` –≤–æ –≤—Å–µ —Å–ø–∏—Å–æ—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã.
