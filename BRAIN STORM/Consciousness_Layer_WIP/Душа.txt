Мы строим локальную ОС на базе LLM. Текущая проблема — "реактивность" (модель просто отвечает на вопрос, не помня глобальных целей) и отсутствие безопасных инструментов.

Нам нужно реализовать два фундаментальных архитектурных слоя. Ты видишь кодовую базу — решай сам, куда лучше интегрировать эти модули, но следуй спецификации ниже.

1. МОДУЛЬ "ДУША" (The Soul / Meta-Cognition)
Проблема: Модель работает как "Мозг Ящерицы" (стимул -> реакция). Ей не хватает "Осознанности" и памяти о глобальных целях проекта. Задача: Реализовать менеджер состояния BDI (Belief-Desire-Intention).

Требования:

Хранилище: JSON-файл (data/soul.json или аналогичный). Структура должна содержать:

axioms: Непреложные истины (например, "Простота > Сложности", "Локальность > Облака").

goals: Текущий стратегический фокус (что мы строим прямо сейчас).

insight: Поле для "озарений" (First Principles Thinking), обновляемое в фоне.

Logic (SoulManager): Класс-синглтон, который читает этот файл и генерирует динамическую инъекцию для Системного Промта.

Инъекция должна быть на АНГЛИЙСКОМ (даже если чат на русском), чтобы модель Qwen лучше следовала инструкциям.

Суть инъекции: "Перед ответом сверься с Аксиомами. Не используй паттерны, если они противоречат эффективности".

2. МОДУЛЬ "ШВЕЙЦАРСКИЙ НОЖ" (Tool Registry)
Концепция: Мы отказываемся от хардкода инструментов. Мы делаем "Рукоятку с магнитным наконечником". Задача: Реализовать гибкий реестр инструментов через декораторы.

Требования:

Decorator Pattern: Я хочу добавлять новые тулы (калькулятор, управление светом, поиск) просто навесив декоратор @registry.register.

Auto-Schema: Реестр должен автоматически генерировать JSON Schema (для function calling) из сигнатуры Python-функции (используя inspect и аннотации типов). Модели Qwen/Dolphin должны понимать, как вызвать этот тул.

Совместимость с Нодами: В будущем мы планируем визуальный редактор (как n8n). Архитектура реестра должна позволять вызывать эти функции изолированно.

3. БЕЗОПАСНОСТЬ И ФАЙЛОВАЯ СИСТЕМА (The Straitjacket & Cerberus)
Контекст: Мы используем Uncensored модель (Abliterated). У неё нет моральных тормозов. Если попросить удалить систему — она удалит. Безопасность должна быть в коде. Задача: Реализовать базовые тулы работы с файлами (read, write, list) с параноидальной защитой.

Протоколы защиты:

Hard Sandbox: Определи жесткую переменную WORKSPACE_ROOT. Любая попытка выхода за пределы (через ../ или абсолютные пути) должна вызывать SecurityError.

Shadow Copy (Backup): Инструмент write_file обязан делать бэкап существующего файла (например, .bak с таймстемпом) перед перезаписью. Никаких исключений.

The Guard (Цербер):

Безопасные операции (read, list, search) -> Выполняются сразу.

Деструктивные операции (write, delete, exec) -> Не выполняются автоматически.

Система должна возвращать статус REQUIRES_CONFIRMATION или требовать явного флага от Роутера. Мы не хотим, чтобы ИИ стер проект в порыве "оптимизации".

ИТОГОВЫЙ ЗАПРОС К ТЕБЕ
Изучи текущую структуру src/. Напиши код для реализации этих трех модулей (Soul, Registry, FileTools). Интегрируй их (или покажи, как интегрировать) в основной цикл чата, чтобы:

Макс "вспомнил", кто он (через Душу).

Макс получил "Руки" (через Реестр).

Макс не сломал мне компьютер (через Сэндбокс).